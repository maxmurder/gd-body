[gd_scene load_steps=3 format=1]

[ext_resource path="res://scenes/limb.tscn" type="PackedScene" id=1]

[sub_resource type="GDScript" id=1]

script/source = "\nextends Node\n\nexport(String, FILE) var materialsFile\nexport(String, FILE) var systemFile\nexport(String, FILE) var flagFile\n\nonready var _materialdata = loadjson(materialsFile)\nonready var _systemdata = loadjson(systemFile)\nonready var _flagdata = loadjson(flagFile)\nvar _limbs = {}\nvar _systems = {}\n\nfunc _ready():\n    _limbs = processbody(self)\n    _systems = processsystems(_limbs)\n    pass\n\nfunc checkstatus(system, threshold, material = \"NONE\", type = \"INTEGRITY\"):\n    for i in system:\n        var node = get_node(i)\n        if material == \"NONE\":\n            for l in node.layers:\n                if node.layers[l][type] < threshold:\n                    return false\n        else:\n            if node.layers.has(material):\n                if node.layers[material][type] < threshold:\n                    return false\n                else:\n                    return checkstatus(system, threshold)\n    return true\n\nfunc processsystems(limbs):\n    var dict = {}\n    for s in _systemdata:\n        var list = []\n        for k in limbs.keys():\n            for i in limbs[k][\"FLAGS\"]:\n                if _flagdata.has(i) and _flagdata[i].has(\"SYSTEMS\"):\n                    for f in _flagdata[i][\"SYSTEMS\"]:\n                        if f == s:\n                            if not k in list:\n                                list.append(k)\n        if list.size() > 0:\n            dict[s] = list\n    return dict\n\nstatic func processbody(node):\n    var dict = {}\n    for n in node.get_children():\n        if n.get_child_count() > 0:\n            var d = processbody(n)\n            for k in d.keys():\n                dict[k] = {\n                    NAME = d[k][\"NAME\"],\n                    SIZE = d[k][\"SIZE\"],\n                    FLAGS = d[k][\"FLAGS\"],\n                    LAYERS = d[k][\"LAYERS\"]\n                }\n        dict[n.get_path()] = {\n            NAME = n.get_name(),\n            SIZE = n.size,\n            FLAGS = n.flags,\n            LAYERS = n.layers\n        }\n    return dict\n\nstatic func loadjson(path):\n    var dict = {}\n    var file = File.new()\n    if !file.file_exists(path):\n        return\n    file.open(path, File.READ)\n    dict.parse_json(file.get_as_text())\n    file.close()\n    return dict\n"

[node name="Char" type="Node2D"]

[node name="Body" type="Node" parent="."]

script/script = SubResource( 1 )
materialsFile = "res://data/materials.json"
systemFile = "res://data/systems.json"
flagFile = "res://data/flags.json"

[node name="body_lower" parent="Body" instance=ExtResource( 1 )]

material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="stomach" parent="Body/body_lower" instance=ExtResource( 1 )]

material_layers = StringArray( "SKIN", "MUSCLE" )
flags = StringArray( "INTERNAL", "DIGESTON", "VASCULAR" )

[node name="body_upper" parent="Body/body_lower" instance=ExtResource( 1 )]

editor/display_folded = true
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="neck" parent="Body/body_lower/body_upper" instance=ExtResource( 1 )]

editor/display_folded = true
size = 0.1
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL", "NERVOUS" )

[node name="head" parent="Body/body_lower/body_upper/neck" instance=ExtResource( 1 )]

editor/display_folded = true
size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "BONE" )
flags = StringArray( "VASCULAR" )

[node name="brain" parent="Body/body_lower/body_upper/neck/head" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "NERVE" )
flags = StringArray( "VITAL", "INTERNAL", "NERVOUS", "VASCULAR", "ARTEREAL", "COGNITIVE" )

[node name="lung_l" parent="Body/body_lower/body_upper" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "MUSCLE" )
flags = StringArray( "RESPRITORY", "VASCULAR", "ARTEREAL" )

[node name="lung_r" parent="Body/body_lower/body_upper" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "MUSCLE" )
flags = StringArray( "RESPRITORY", "VASCULAR", "ARTEREAL" )

[node name="heart" parent="Body/body_lower/body_upper" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "MUSCLE" )
flags = StringArray( "VITAL", "ARTEREAL", "INTERNAL" )

[node name="l_arm_upper" parent="Body/body_lower/body_upper" instance=ExtResource( 1 )]

editor/display_folded = true
size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="l_arm_lower" parent="Body/body_lower/body_upper/l_arm_upper" instance=ExtResource( 1 )]

size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="l_hand" parent="Body/body_lower/body_upper/l_arm_upper/l_arm_lower" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "GRASP" )

[node name="r_arm_upper" parent="Body/body_lower/body_upper" instance=ExtResource( 1 )]

editor/display_folded = true
size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="r_arm_lower" parent="Body/body_lower/body_upper/r_arm_upper" instance=ExtResource( 1 )]

size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="r_hand" parent="Body/body_lower/body_upper/r_arm_upper/r_arm_lower" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "GRASP" )

[node name="stomach" parent="Body/body_lower/body_upper/r_arm_upper/r_arm_lower" instance=ExtResource( 1 )]

material_layers = StringArray( "SKIN", "MUSCLE" )
flags = StringArray( "VASCULAR", "DIGESTION" )

[node name="l_leg_upper" parent="Body/body_lower" instance=ExtResource( 1 )]

editor/display_folded = true
size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="l_leg_lower" parent="Body/body_lower/l_leg_upper" instance=ExtResource( 1 )]

size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="l_foot" parent="Body/body_lower/l_leg_upper/l_leg_lower" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "LOCOMOTION" )

[node name="r_leg_upper" parent="Body/body_lower" instance=ExtResource( 1 )]

editor/display_folded = true
size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="r_leg_lower" parent="Body/body_lower/r_leg_upper" instance=ExtResource( 1 )]

size = 0.25
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "ARTEREAL" )

[node name="r_foot" parent="Body/body_lower/r_leg_upper/r_leg_lower" instance=ExtResource( 1 )]

size = 0.1
material_layers = StringArray( "SKIN", "MUSCLE", "NERVE", "BONE" )
flags = StringArray( "VASCULAR", "LOCOMOTION" )


